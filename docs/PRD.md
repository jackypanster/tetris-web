# PRD.md（產品需求說明）— Tetris Web 版

## 1. 產品目標
- 在桌面瀏覽器提供穩定 60 FPS 的俄羅斯方塊體驗，支援離線遊玩。
- 透過可選的高分榜 API（FastAPI + uv）同步玩家分數，維持 14 天或 Top-N 排行。
- 保障後續自動化流水線（plan → skeleton → impl → gate → docs → accept）可復跑，文檔是唯一事實源。

## 2. 核心玩法範圍
- 10×20 棋盤，七種方塊（I/O/T/S/Z/J/L）採 **Bag-7** 隨機器。
- 旋轉系統使用簡化 SRS，含牆踢；支援 soft drop、hard drop、暫停，鎖定延遲 ~500ms 可調。
- 計分：單/雙/三/四消累進；Back-to-Back 與連擊加成可選開關。
- 升級節奏：隨消行遞增速度，維持輸入延遲 P95 ≤ 16ms。

## 3. 高分榜後端範圍
- 提供 `POST /scores` 提交分數、`GET /scores` 查排行，契約詳見 `docs/openapi.yaml`。
- 投稿資訊：暱稱（1-16 字元）、分數（≥0）、客戶端指紋（版本 + UA），支援匿名。
- 可關閉後端而不影響本地遊戲；前端網絡層應容錯超時與 400/429。

## 4. 非功能性要求
- **性能**：渲染 + 遊戲邏輯 < 16ms/frame；鍵盤輸入延遲 P95 < 16ms。
- **可測性**：旋轉、消行、隨機器、鎖定延遲、計分均有單元測試；提供 Playwright E2E 操作序列。
- **安全/隱私**：拒絕敏感資訊上傳，高分榜速率限制與輸入校驗。
- **可觀測**：開發模式輸出行消次數、平均下落速度、最大連擊、渲染耗時分佈。

## 5. 功能細節
- `Board`：維護網格狀態、行消邏輯、行下沉。
- `Piece`：含旋轉表、牆踢資料；支援 180° 旋轉作為可選功能旗標。
- `RNG`：Bag-7 實作，確保任意 14 顆內涵蓋兩輪完整七子。
- `Game` 狀態機：`Spawn → Active → Lock → Clear → Over`，處理暫停與重新開始。
- `render()`：Canvas 或 WebGL；渲染場景、活動方塊與 Ghost Piece。
- `input/`：鍵盤去抖與自定 DAS/ARR；可插拔以支援手柄。
- 音效、皮膚屬延伸目標，可列入 TODO，不影響 MVP。

## 6. 成功指標與邊界
- Acceptance 準則對應 `docs/Acceptance.md`（A-001 ~ A-007）。
- 測試覆蓋：單元行覆蓋 ≥ 80%，分支 ≥ 70%；性能測試需證明 P95 指標達標。
- 未納入範圍：多人對戰、雲端存檔、登入系統；若後續需要，需先更新本 PRD 與契約。

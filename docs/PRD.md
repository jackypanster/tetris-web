# PRD.md — Tetris Web 版（2025-09）

本文件描述目前已實作的《Tetris Web》功能範圍，作為產品事實來源。對應的技術細節見 `docs/ARCH.md`，驗收條件見 `docs/Acceptance.md`。

## 1. 產品定位
- 目標族群：希望在桌面瀏覽器快速體驗經典俄羅斯方塊、並查看公開排行榜的玩家。
- 核心價值：免安裝、可離線練習、重新連線後自動同步分數，並提供即時排行榜反饋。

## 2. 使用者情境
1. **快速遊玩**：進入頁面後立即看到棋盤，按下「Start Game」即可開始；控制鍵為方向鍵或 WASD，空白鍵為 Hard Drop。
2. **記錄與比較**：遊戲結束時自動提交分數，右側排行榜顯示最新 10 筆紀錄，含分數與消行數。
3. **離線練習**：斷網時仍可遊玩；分數暫存於本地佇列並顯示待送狀態，恢復連線後自動上傳。

## 3. 功能範圍（現況）
### 3.1 遊戲體驗
- 棋盤為 10×20，提供 I/O/T/S/Z/J/L 七種方塊，使用隨機佇列預先生成三顆預覽。
- 方塊旋轉與移動：左/右移動、下鍵加速、`Z`/`W`/`ArrowUp` 旋轉、空白鍵 Hard Drop，`Pause` 按鈕可切換暫停。
- 計分：依行數給分（單/雙/三/四消 = 40/100/300/1200 × 當前等級），每 10 行提升等級並縮短落子間隔（最低 50ms）。
- 狀態面板：畫面左側即時顯示下一顆方塊、分數、消行數、等級與操作提示，避免遮擋棋盤。

### 3.2 排行榜與同步
- 排行榜展示後端 `/scores` API 回傳的 10 筆最新高分，依分數與建立時間排序。
- 遊戲結束後自動提交分數；成功時即刻刷新排行榜，失敗（離線或伺服器錯誤）則寫入本地佇列並提示待送數量。
- 本地佇列使用 `localStorage` 保存；恢復線上或每分鐘自動嘗試批次上傳至 `/scores/bulk`。

### 3.3 後端行為
- FastAPI 服務提供 `/scores`（GET/POST）與 `/scores/bulk`（POST）及 `/healthz` 健康檢查。
- 暱稱長度限制 1–16 字元，分數需為非負整數；批次提交會逐筆驗證並回報被拒原因。
- 目前採用記憶體儲存，啟動後僅保留執行期間的資料。

## 4. 非功能需求
- **效能**：在現代桌面瀏覽器（Chromium 110+/Firefox 110+/Safari 16+）於 1080p、60Hz 下維持流暢動畫；後端在單機環境支援每秒數十筆請求。
- **可用性**：頁面載入後 1 秒內可開始遊戲；所需操作提示均位於左側面板。
- **可靠性**：離線時不丟失分數，佇列狀態清楚呈現；伺服器錯誤時提供重試提示。

## 5. 未來工作（Backlog 摘要）
- 正式 BAG-7 隨機器與更多旋轉測試。
- 更完整的 Service Worker 緩存策略與 UI 導覽。
- 永續儲存（SQLite 或雲端資料庫）與後端指標監控。
- 自動化測試與覆蓋率門檻（見 `docs/TESTPLAN.md`）。

# TESTPLAN.md — Tetris Web 版測試計畫（2025-09）

本計畫定義現階段的手動驗證步驟與後續自動化目標。覆蓋面向與產品功能對應關係請參考 `docs/PRD.md`。

## 1. 現況摘要
- **自動化測試**：尚未建立（前端與後端皆為 TODO）。
- **手動驗證**：每次改版需完成下列表格的檢查項，以避免回歸。

## 2. 手動驗證清單
| 編號 | 場景 | 操作 | 預期結果 |
|------|------|------|-----------|
| M-01 | 遊戲開局 | 點擊 Start Game，使用方向鍵移動、`Z`/`ArrowUp` 旋轉、`Space` 落下 | 方塊動作立即生效，無異常閃爍或卡死 |
| M-02 | 下一顆預覽 | 在遊戲進行中觀察左側 Next Piece | 顯示與下一顆實際落下的方塊一致 |
| M-03 | 計分與等級 | 進行至少 10 行消除 | Stats 面板顯示正確分數、行數、等級；落子速度逐步提升 |
| M-04 | 排行榜提交 | 遊戲結束 | 新分數進入排行榜；若伺服器正常則即時顯示 |
| M-05 | 離線佇列 | 關閉後端或離線後再結束遊戲 | 狀態文字顯示「待送 N / 失敗 M」，`localStorage` 生成佇列資料 |
| M-06 | 重新上線 | 恢復後端並等待 1 分鐘或手動觸發 `navigator.onLine` | 佇列清空並刷新排行榜 |
| M-07 | API 健康檢查 | 訪問 `/healthz`、`/scores`（GET/POST） | 回傳 JSON；錯誤輸入回傳 400/429 等對應代碼 |

> 建議在 Chrome/Firefox/Safari 三種瀏覽器各跑一次 M-01～M-04，確保輸入與繪製一致。

## 3. 自動化目標（待建立）
| 類型 | 工具 | 內容 | 備註 |
|------|------|------|------|
| 單元測試 | Vitest | `core/game.ts` 旋轉、消行、計分邏輯 | 需 mock `performance.now` 確保可重現 |
| 單元測試 | Pytest | `/scores` 端點 200/201/207/400 驗證 | 以 FastAPI TestClient 模擬 |
| 合成測試 | Playwright | 測試 Start → Hard Drop → 提交分數流程 | 用於 CI 冒煙測試 |
| 型別/Lint | pnpm scripts | `pnpm run type-check`、`pnpm run lint` | 建置前自動執行 |

## 4. 測試資料
- 基本案例：`nickname = 
